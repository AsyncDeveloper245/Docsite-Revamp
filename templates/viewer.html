<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ pagename }}</title>
    <link href="/vendor/fontawesome/css/all.min.css" rel="stylesheet" />
    <!-- CSS only -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
      integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
      crossorigin="anonymous"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,600;0,700;1,300;1,400;1,600;1,700&display=swap"
      rel="stylesheet"
    />

    <!-- Get locas CSS files -->
    {% for file in css %}
    <link rel="stylesheet" type="text/css" href="{{ file }}" />
    {% endfor %}
  </head>
  <body>
    <!---->
    {% include 'navbar.html' %}

    <div class="row">
      <div class="col-md-3">
        <div class="container-fluid sidebar-container">
          <div class="sidebar">
            {{ sidebar}}
            <ul class="main">
              <li class="inactive">
                <a href="/output/Data_Dictionary">About</a>
              </li>
              <li class="main"><a href="/output/Data_Dictionary">Viewer</a></li>
              <ul></ul>
              <li class="inactive">
                <a href="/output/Data_Dictionary">Search</a>
              </li>
              <li class="inactive">
                <a href="/output/Data_Dictionary/Release_Notes"
                  >Release Notes</a
                >
              </li>
            </ul>
          </div>
        </div>
      </div>
      <div class="col-md-9">
        <div class="container-fluid doc-container" id="doc-container">
          <h1><i class="fas fa-book"></i> Data Dictionary Viewer</h1>
          <hr />
          <p
            id="dictionary-preamble"
            style="margin: 2rem auto 4rem auto; width: 95%"
          >
            The GDC data dictionary viewer is a user-friendly interface for
            accessing the <a href="../">GDC Data Dictionary</a>.
          </p>
          <div class="loadingContainer" id="dictionary-loading-icon">
            <div class="spinParticleContainer">
              <div class="particle red"></div>
              <div class="particle grey other-particle"></div>
              <div class="particle blue other-other-particle"></div>
            </div>
          </div>
          <div id="dictionary-app-container"></div>
        </div>
      </div>
    </div>

    <footer id="docs-footer">
      <div class="container-fluid footer-container">
        <div>
          <a href="https://portal.gdc.cancer.gov" target="_blank">Site Home</a>
          |
          <a href="http://www.cancer.gov/global/web/policies" target="_blank"
            >Policies</a
          >
          |
          <a
            href="http://www.cancer.gov/global/web/policies/accessibility"
            target="_blank"
            >Accessibility</a
          >
          |
          <a
            href="http://www.cancer.gov/global/web/policies/foia"
            target="_blank"
            >FOIA</a
          >
        </div>
        <div>
          <a href="http://www.hhs.gov" target="_blank"
            >U.S. Department of Health and Human Services</a
          >
          |
          <a href="http://www.nih.gov" target="_blank"
            >National Institutes of Health</a
          >
          |
          <a href="http://www.cancer.gov" target="_blank"
            >National Cancer Institute</a
          >
          | <a href="http://www.usa.gov" target="_blank">USA.gov</a>
        </div>
        <div>NIH... Turning Discovery Into Health Â®</div>

        <div class="version-caption">GDC Docs Version 2.0</div>
      </div>
    </footer>

    <script>
      /* When the user clicks on the button, 
toggle between hiding and showing the dropdown content */

      // Close the dropdown if the user clicks outside of it

      var toggler = document.getElementById("myToggle");
      toggler.onclick = function () {
        var myDropdown = document.getElementById("myDropdown");
        myDropdown.classList.toggle("show");
      };
      window.onclick = function (e) {
        if (!e.target.matches(".dropbtn")) {
          var myDropdown = document.getElementById("myDropdown");
          if (myDropdown.classList.contains("show")) {
            myDropdown.classList.remove("show");
          }
        }
      };
    </script>

    <!-- Dictionary Builder -->
    <script>
      function split(str) {
        return str
          .split(" ")
          .map((w) => w[0].toUpperCase() + w.substr(1).toLowerCase())
          .join(" ");
      }

      // Function to Get data from API
      async function get(url) {
        let obj = await (await fetch(url)).json();
        return obj;
      }

      // Get URL Parameters
      const urlParams = new URLSearchParams(window.location.search);

      // Get Segment of page to append elements to (currently body)
      var myBody = document.getElementById("doc-container"); // Change this to whatever  container everything is in once css is built

      // Declare variables to be used and start async function
      var data, table, tbody, tr, td1, td2, td3, td4, thead, th, h2;
      (async () => {
        // Get Data from GDC Dictionary API
        data = await get(
          "https://api.gdc.cancer.gov/v0/submission/_dictionary/_all"
        );

        // If querystring contains node, show node page
        if (urlParams.has("node")) {
          var key = urlParams.get("node");
          var node = data[key];

          // Add Summary Section

          // Summary Header
          h2 = document.createElement("h2");
          h2.innerHTML = "Summary";
          myBody.appendChild(h2);

          // Create Summary Table
          table = document.createElement("table");
          table.setAttribute("class", "table");
          tbody = document.createElement("tbody");

          // Fill in Summary Table
          var summaryAttrs = {
            Type: "type",
            Category: "category",
            Description: "description",
            "Unique Keys": "uniqueKeys",
          };
          for (var key in summaryAttrs) {
            var nodeAttr = node[summaryAttrs[key]];
            tr = document.createElement("tr");
            td1 = document.createElement("td");
            td2 = document.createElement("td");
            td1.innerHTML = key;
            td2.innerHTML = nodeAttr;
            tr.appendChild(td1);
            tr.appendChild(td2);
            tbody.appendChild(tr);
            table.appendChild(tbody);
            myBody.appendChild(table);
          }

          // Add Links Section

          // Add Links Header
          h2 = document.createElement("h2");
          h2.innerHTML = "Links";
          myBody.appendChild(h2);

          //Create Links Table
          table = document.createElement("table");
          table.setAttribute("class", "table");
          tbody = document.createElement("tbody");
          thead = document.createElement("thead");

          // Fill in links table head
          th = document.createElement("th");
          th.innerHTML = "Links to Entity";
          thead.appendChild(th);
          th = document.createElement("th");
          th.innerHTML = "Link Name";
          thead.appendChild(th);
          th = document.createElement("th");
          th.innerHTML = "Relationship";
          thead.appendChild(th);
          th = document.createElement("th");
          th.innerHTML = "Required?";
          thead.appendChild(th);
          table.appendChild(thead);

          // Fill in Links Table
          for (var i = 0; i < node["links"].length; i++) {
            tr = document.createElement("tr");
            td = document.createElement("td");
            td.innerHTML = node["links"][i]["target_type"];
            tr.appendChild(td);
            td = document.createElement("tr");
            td.innerHTML = node["links"][i]["name"];
            tr.appendChild(td);
            td = document.createElement("td");
            td.innerHTML =
              node["links"][i]["backref"] +
              " " +
              node["links"][i]["label"] +
              " " +
              node["links"][i]["target_type"];
            tr.appendChild(td);
            td = document.createElement("td");
            td.innerHTML = node["links"][i]["required"];
            tr.appendChild(td);
            tbody.appendChild(tr);
          }

          table.appendChild(tbody);
          myBody.appendChild(table);

          // Properties Section

          // Create Properties Header
          h2 = document.createElement("h2");
          h2.innerHTML = "Properties";
          myBody.appendChild(h2);

          // Create Properties Table
          table = document.createElement("table");
          table.setAttribute("class", "table");
          tbody = document.createElement("tbody");
          thead = document.createElement("thead");

          // Fill in Properties Table Head
          th = document.createElement("th");
          th.innerHTML = "Property";
          thead.appendChild(th);
          th = document.createElement("th");
          th.innerHTML = "Description";
          thead.appendChild(th);
          th = document.createElement("th");
          th.innerHTML = "Acceptable Types or Values";
          thead.appendChild(th);
          th = document.createElement("th");
          th.innerHTML = "Required?";
          thead.appendChild(th);
          th = document.createElement("th");
          th.innerHTML = "CDE";
          thead.appendChild(th);
          table.appendChild(thead);

          // Fill in Properties table
          for (var i in node["properties"]) {
            tr = document.createElement("tr");
            td = document.createElement("td");
            td.innerHTML = i;
            tr.appendChild(td);
            td = document.createElement("td");
            td.innerHTML = node["properties"][i]["description"];
            tr.appendChild(td);
            td = document.createElement("td");
            if (Object.keys(node["properties"][i]).includes("oneOf")) {
              td.innerHTML = node["properties"][i]["oneOf"];
            } else {
              td.innerHTML = node["properties"][i]["enum"];
            }
            tr.appendChild(td);
            td = document.createElement("td");
            td.innerHTML = String(node["required"].includes(i));
            tr.appendChild(td);
            td = document.createElement("td");
            if (Object.keys(node["properties"][i]).includes("termDef")) {
              td.innerHTML = node["properties"][i]["termDef"]["cde_id"];
            } else {
              td.innerHTML = "--";
            }
            tr.appendChild(td);
            tbody.appendChild(tr);
          }
          table.appendChild(tbody);
          myBody.appendChild(table);
          //console.log(node['properties']);
        }

        // Otherwise build main page
        else {
          for (var key of Object.keys(data)) {
            console.log(key);

            if (key[0] != "_") {
              // Get Table for category of current object
              table = document.getElementById(data[key]["category"] + "-table");

              // Check if Table exists in document
              if (table != null) {
                // If Table Exists append current attribute to Table
                tbody = table.tBodies[0];
                tr = document.createElement("tr");
                td1 = document.createElement("td");
                td2 = document.createElement("td");
                a = document.createElement("a");
                a.setAttribute("href", "?node=" + key);
                a.innerHTML = data[key]["title"];
                td1.appendChild(a);
                td2.innerHTML = data[key]["description"];
                tr.appendChild(td1);
                tr.appendChild(td2);
                tbody.appendChild(tr);
              } else {
                //Else Create Table

                // Create Table
                table = document.createElement("table");
                table.setAttribute("class", "table");
                table.setAttribute("id", data[key]["category"] + "-table");

                // Create Table heading
                thead = document.createElement("thead");
                tr = document.createElement("tr");
                th = document.createElement("th");
                th.setAttribute("colspan", 2);
                th.innerHTML = split(data[key]["category"]);
                tr.appendChild(th);
                thead.appendChild(tr);

                // Create Table body
                tbody = document.createElement("tbody");
                a = document.createElement("a");
                a.setAttribute("href", "?node=" + key);
                tr = document.createElement("tr");
                td1 = document.createElement("td");
                td2 = document.createElement("td");
                a.innerHTML = data[key]["title"];
                td1.appendChild(a);
                td2.innerHTML = data[key]["description"];
                tr.appendChild(td1);
                tr.appendChild(td2);
                tbody.appendChild(tr);

                // Append Everything together
                table.appendChild(thead);
                table.appendChild(tbody);
                myBody.appendChild(table);
              }
            }
          }
        }
      })();
    </script>

    <!-- JavaScript Bundle with Popper -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
